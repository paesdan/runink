@startuml
left to right direction
skinparam packageStyle rectangle
skinparam defaultTextAlignment center
skinparam backgroundColor #FFFFFF

' Define custom colors
skinparam rectangle {
    BackgroundColor<<ExecutionGroup>> #E6FFE6
    BackgroundColor<<RecoveryGroup>> #FFE6E6
    BorderColor<<ExecutionGroup>> #228B22
    BorderColor<<RecoveryGroup>> #CC0000
}

skinparam node {
    BackgroundColor<<Execution>> LightGreen
    BackgroundColor<<Recovery>> LightCoral
}
skinparam ArrowColor Black
skinparam ArrowThickness 1

header ğŸ“Š MapReduce vs RDD vs Raft (Runink)  
title ğŸš€ Normal Execution and Crash Recovery Comparison

' ========== Execution Flow (Normal) ==========

rectangle "âœ… Normal Operation (Execution Flow)" <<ExecutionGroup>> {
  package "MapReduce" <<Execution>> {
    [Input Data ğŸ“‚] --> [Map Phase ğŸ› ï¸]
    note right of [Input Data ğŸ“‚]
      Data stored in HDFS or similar.
    end note
    note right of [Map Phase ğŸ› ï¸]
      Map workers process chunks independently.
    end note
    [Map Phase ğŸ› ï¸] --> [Shuffle & Sort Phase ğŸ”€]
    note right of [Shuffle & Sort Phase ğŸ”€]
      Intermediate data is grouped by key.
    end note
    [Shuffle & Sort Phase ğŸ”€] --> [Reduce Phase ğŸ› ï¸]
    note right of [Reduce Phase ğŸ› ï¸]
      Final output written to distributed storage with reducers aggregate and finalize the results.
    end note
  }

  package "RDD (Spark)" <<Execution>> {
    [Input Data ğŸ“‚] --> [RDD Transformations ğŸ”„]
    note right of [RDD Transformations ğŸ”„]
      Lazy transformations build a logical DAG.
    end note
    [RDD Transformations ğŸ”„] --> [Action Trigger â–¶ï¸]
    note right of [Action Trigger â–¶ï¸]
      Action like `collect` or `save` triggers computation.
    end note
    [Action Trigger â–¶ï¸] --> [Job Scheduler ğŸ“‹]
    note right of [Job Scheduler ğŸ“‹]
      Scheduler splits tasks across executors.
    end note
    [Job Scheduler ğŸ“‹] --> [Cluster Execution (Executors) âš™ï¸]
    note right of [Cluster Execution (Executors) âš™ï¸]
      Tasks are executed on worker nodes.
    end note
    [Cluster Execution (Executors) âš™ï¸] --> [Output Data ğŸ“¦]
    note right of [Output Data ğŸ“¦]
      Results are persisted or returned to client.
    end note
  }

  package "Raft (Runink)" <<Execution>> {
    [Input Data ğŸ“‚] --> [Raft Commit (Contracts + Metadata) ğŸ—„ï¸]
    note right of [Raft Commit (Contracts + Metadata) ğŸ—„ï¸]
      Declarative scenario contracts and metadata are committed atomically via Raft.
    end note
    [Raft Commit (Contracts + Metadata) ğŸ—„ï¸] --> [Runi Scheduler (Raft-backed) ğŸ§ ]
    note right of [Runi Scheduler (Raft-backed) ğŸ§ ]
      Scheduler matches tasks to available nodes deterministically.
    end note
    [Runi Scheduler (Raft-backed) ğŸ§ ] --> [Launch Slices (Isolated Workers) ğŸš€]
    note right of [Launch Slices (Isolated Workers) ğŸš€]
      Ephemeral Go processes run pipeline steps securely.
    end note
    [Launch Slices (Isolated Workers) ğŸš€] --> [Output Data ğŸ“¦]
    note right of [Output Data ğŸ“¦]
      Outputs include lineage, metrics, and validated results.
    end note
  }
}

' ========== Failure Recovery Flow (Crash) ==========

rectangle "âš¡ Failure Recovery Flow (Crash Handling)" <<RecoveryGroup>> {
  skinparam RectangleBorderThickness 2
  skinparam RectangleBorderStyle dashed

  package "MapReduce Failure" <<Recovery>> {
    [Input Data ğŸ“‚] --> [Map Phase Running ğŸ› ï¸]
    [Map Phase Running ğŸ› ï¸] --> [Map Node Crash ğŸ›‘]
    note right of [Map Node Crash ğŸ›‘]
      Loss of a mapper requires full job restart.
    end note
    [Map Node Crash ğŸ›‘] --> [Job Fails Entirely âŒ]
    [Job Fails Entirely âŒ] --> [Manual Restart Needed ğŸ”„]
    note right of [Manual Restart Needed ğŸ”„]
      Human intervention needed to resubmit the job.
    end note
  }

  package "RDD Failure (Spark)" <<Recovery>> {
    [Input Data ğŸ“‚] --> [RDD Execution Running ğŸ”„]
    [RDD Execution Running ğŸ”„] --> [RDD Node Crash ğŸ›‘]
    note right of [RDD Node Crash ğŸ›‘]
      Executor crash triggers partial recomputation.
    end note
    [RDD Node Crash ğŸ›‘] --> [Driver Attempts Lineage Recompute ğŸ”]
    note right of [Driver Attempts Lineage Recompute ğŸ”]
      Driver uses DAG lineage to rebuild lost partitions.
    end note
    [Driver Attempts Lineage Recompute ğŸ”] --> [Partial or Full Job Restart ğŸ”„]
    note right of [Partial or Full Job Restart ğŸ”„]
      Recovery success depends on cached data and stage failures.
    end note
  }

  package "Raft (Runink) Failure" <<Recovery>> {
    [Input Data ğŸ“‚] --> [Slice Running ğŸš€]
    [Slice Running ğŸš€] --> [Raft Node Crash ğŸ›‘]
    note right of [Raft Node Crash ğŸ›‘]
      Node crash detected by Raft heartbeat timeouts.
    end note
    [Raft Node Crash ğŸ›‘] --> [Raft Detects Loss + Elects New Leader ğŸ§ ]
    note right of [Raft Detects Loss + Elects New Leader ğŸ§ ]
      Leader election ensures continued consistency.
    end note
    [Raft Detects Loss + Elects New Leader ğŸ§ ] --> [Reschedule Slice Elsewhere â™»ï¸]
    note right of [Reschedule Slice Elsewhere â™»ï¸]
      Slices are re-assigned to healthy nodes automatically.
    end note
    [Reschedule Slice Elsewhere â™»ï¸] --> [Continue Execution Seamlessly âœ…]
    note right of [Continue Execution Seamlessly âœ…]
      Pipeline continues with no manual intervention.
    end note
  }
}

@enduml
